{% extends "base.html" %}

{% block mainCSS %}
<link rel="stylesheet" type="text/css" href="/static/css/style.css"></link>
{% endblock %}

{% block mainTitle %} TorStatus Unpaged Index {% endblock %}

{% block headerTitle %} TorStatus {% endblock %}

{% block extraHeader %}
<table cellspacing="1" cellpadding="2" class="legend">
<tr>
	<td class="boxTitle">Legend</td>
</tr>
<tr>
	<td class="relayOK">Router is ok</td>
</tr>
<!-- We can not check for these at the moment -->
<!-- 
<tr>
	<td class="relayHibernating">Router is hibernating</td>
</tr>
<tr>
	<td class="relayDown">Router is currently down</td>
</tr>
-->
<tr>
	<td class="relayBadExit">Router is a bad exit node</td>
</tr>
</table>
<br />
<table class="appServerDetails" id="serverdetails">
<tr>
	<td class="boxTitle" colspan="2">Application Server Details</td>
</tr>
<tr id="row_appServerDetails">
	<td>Cache Last Updated (Local Server Time):</td>
    <td>{{ cache_updated }}</td>
</tr>
<tr id="row_appServerDetails">
	<td>Last Update Cycle Processing Time (Seconds):</td>
    <td>{{ proc_time }}</td>
</tr>
<tr id="row_appServerDetails">
	<td>Current Cache Expire Time (Seconds):</td>
    <td>{{ exp_time }}</td>
</tr>
<tr id="row_appServerDetails">
	<td>Number of Routers In Cache:</td>
    <td>{{ num_routers }}</td>
</tr>
<tr id="row_appServerDetails">
	<td>Number of Descriptors In Cache:</td>
    <td>{{ num_descs }}</td>
</tr>
<tr id="row_appServerDetails">
	<td>Approximate Page Generation Time (Seconds):</td>
    <td>{{ gen_time }}</td>
</tr>
</table>

{% endblock %}

{% block mainPage %}

{% load index_filters %}
{% spaceless %}

{% if relay_list %}
<table class="relayTable">
    <tr>
        {% autoescape off %}
        {% for column in htmlCurrentColumns %}
            {{ htmlTableHeaders|key:column }}
        {% endfor %}
        {% endautoescape %}
    </tr>
    {% autoescape off %}
        {% for relay_row in htmlRowCode %}
            {{relay_row}}
        {% endfor %}
    {% endautoescape %}
</table>
{% else %}
<table id="noTableError">
    <tr>
        <td id="boxError"> Sorry, your query options did not return any results. </td>
    </tr>
</table>
{% endif %}


<br />
<br />

<table class="bottomTables1">
<tr>
<td>
<table class="aggStatisticSummary" id="advanceddisplayoptions">
<tr>
    <td class="boxTitle" colspan="1">Custom / Advanced Display Options</td>
</tr>
<tr>
    <td id="aggBox" ><a class="link" href="column-preferences">Column Display Preference</a></td>
</tr>
</table>
</td>
<tr>
<td>
<table class="aggStatisticSummary" id="advancedquery">
<tr>
    <td class="boxTitle" colspan="1">Custom / Advanced Query Options</td>
</tr>
<tr>
    <td>
        <table id="sortRouterListing">
        <tr>
            <td colspan="2">
                <form action="/" method="get">
                    <input type="hidden" name="resetQuery" value="resetQuery" />
                    <input id="sortRouterListing_Button" type="submit" value="Reset the Query to DEFAULT" />
                </form>
            </td>
        </tr>
        </table>
    </td>
</tr>
<tr>
    <td>
        <table id="sortRouterListing">
        <tr>
            <td> Sort Router Listing By: </td>
            <td>
                <form action="/" method="get">
                <select id="sortRouterListing" name="sortListings">
                {% autoescape off %}
                    {% for option in htmlQueryListOptions %}
                       {{option}}
                    {% endfor %}
                {% endautoescape %}
                </select>
            </td>
        </tr>
        <tr>
            <td> Sort Order: </td>
            <td>
                <select id="sortRouterListing" name="sortOrder">
                <option value="ascending" {% if queryOptions and queryOptions|key:'sortOrder' == "ascending" %} 
                                                            SELECTED {% endif %}>Ascending</option>
                <option value="descending" {% if queryOptions and queryOptions|key:'sortOrder' == "descending" %} 
                                                            SELECTED {% endif %}>Descending</option>
                </select>
            </td>
        </tr>
        <tr>
            <td id="sortRouterListing" colspan="2"> Require Flags </td>
        </tr>
        {% autoescape off %}
            {% for option in htmlQueryInputOptions %}
                <tr>{{option}}</tr>
            {% endfor %}
        {% endautoescape %}
        </table>
</tr>
<tr>
    <td>
        <table id="sortRouterListing">
        <tr>
            <td id="sortRouterListing" colspan="2"> Advanced Search </td>
        </tr>
        <tr>
            <td>
            <select id="sortRouterListing" name="criteria">
            <option value ="fingerprint" {% if not queryOptions or queryOptions|key:'criteria' == "fingerprint" %}
                                                            SELECTED {% endif %}>Fingerprint</option>
            <option value ="nickname" {% if queryOptions and queryOptions|key:'criteria' == "nickname" %}
                                                            SELECTED {% endif %}>Router Name</option>
            <option value ="geoip" {% if queryOptions and queryOptions|key:'criteria' == "geoip" %}
                                                            SELECTED {% endif %}>Country Code</option>
            <option value ="bandwidthobserved" {% if queryOptions and queryOptions|key:'criteria' == "bandwidthobserved" %}
                                                            SELECTED {% endif %}>Bandwidth (kb/s)</option>
            <option value ="uptime" {% if queryOptions and queryOptions|key:'criteria' == "uptime" %}
                                                            SELECTED {% endif %}>Uptime (days)</option>
            <option value ="published" {% if queryOptions and queryOptions|key:'criteria' == "published" %}
                                                            SELECTED {% endif %}>Last Descriptor Published</option>
            <option value ="address" {% if queryOptions and queryOptions|key:'criteria' == "address" %}
                                                            SELECTED {% endif %}>IP Address</option>
            <option value ="hostname" {% if queryOptions and queryOptions|key:'criteria' == "hostname" %}
                                                            SELECTED {% endif %}>Hostname</option>
            <option value ="orport" {% if queryOptions and queryOptions|key:'criteria' == "orport" %}
                                                            SELECTED {% endif %}>Onion Router Port</option>
            <option value ="dirport" {% if queryOptions and queryOptions|key:'criteria' == "dirport" %}
                                                            SELECTED {% endif %}>Directory Sever Port</option>
            <option value ="platform" {% if queryOptions and queryOptions|key:'criteria' == "platform" %}
                                                            SELECTED {% endif %}>Platform</option>
            </select>
            </td>
            <td>
            <select id="sortRouterListing" name="boolLogic">
            <option value ="equals" {% if not queryOptions or queryOptions|key:'boolLogic' == "equals" %}
                                                            SELECTED {% endif %}>Equals</option>
            <option value ="contains" {% if queryOptions and queryOptions|key:'boolLogic' == "contains" %}
                                                            SELECTED {% endif %}>Contains</option>
            <option value ="less" {% if queryOptions and queryOptions|key:'boolLogic' == "less" %}
                                                            SELECTED {% endif %}>Is Less Than</option>
            <option value ="greater" {% if queryOptions and queryOptions|key:'boolLogic' == "greater" %}
                                                            SELECTED {% endif %}>Is Greater Than</option>
            </select>
            </td>
        </tr>
        <tr>
            <td colspan="2">
            <input id="sortRouterListing" type="text" name="searchValue" {% if queryOptions and queryOptions|key:'searchValue' %}
                                                                    value="{{queryOptions|key:'searchValue'}}" 
                                                                    {% endif %}/>
            </td>
        </tr>
        </table>
    </td>
</tr>
<tr>
    <td>
        <table id="sortRouterListing">
        <tr>
            <td colspan="2">
                <input id="sortRouterListing_Button" type="submit" value="Apply Options" />
            </td>
        </tr>
        </table>
        </form>
    </td>
</tr>
</table>
</td>
</tr>
<tr>
<td>
<table class="aggStatisticSummary" id="networkstatisticsummary">
<tr>
    <td class="boxTitle" colspan="3">Aggregate Network Statistic Summary |
    <a class="link" href="network-statistic-graphs">Graphs / Details</a>
    </td>
</tr>
<tr id="row_aggStatisticSummary">
	<td id="aggBox">Total average bandwidth of displayed routers [KB/s]:</td>
    <td id="aggBox">{{ counts.bandwidthavg }}</td>
    <td id="aggBox">{{ counts.bandwidthavg|percent:total_counts.bandwidthavg }}</td>
</tr>
<tr id="row_aggStatisticSummary">
	<td id="aggBox">Total burst bandwidth of displayed routers [KB/s]:</td>
    <td id="aggBox">{{ counts.bandwidthburst }}</td>
    <td id="aggBox">{{ counts.bandwidthburst|percent:total_counts.bandwidthburst }}</td>
</tr>
<tr id="row_aggStatisticSummary">
	<td id="aggBox">Total observed bandwidth of displayed routers [KB/s]:</td>
    <td id="aggBox">{{ counts.bandwidthobserved }}</td>
    <td id="aggBox">{{ counts.bandwidthobserved|percent:total_counts.bandwidthobserved }}</td>
</tr>
<tr id="row_aggStatisticSummary">
	<td id="aggBox">Total number of Routers:</td>
    <td id="aggBox">{{ num_routers }}</td>
    <td id="aggBox">{{ num_routers|percent:num_routers }}</td>
</tr>
<tr id="row_aggStatisticSummary">
	<td id="aggBox">Routers in current query result set:</td>
    <td id="aggBox">{{ in_query }}</td>
    <td id="aggBox">{{ in_query|percent:num_routers }}</td>
</tr>
<tr id="row_aggStatisticSummary">
	<td id="aggBox">Total number of 'authority' routers:</td>
    <td id="aggBox">{{ counts.isauthority }}</td>
    <td id="aggBox">{{ counts.isauthority|percent:num_routers }}</td>
</tr>
<tr id="row_aggStatisticSummary">
	<td id="aggBox">Total number of 'bad directory' routers:</td>
    <td id="aggBox">{{ counts.isbaddirectory }}</td>
    <td id="aggBox">{{ counts.isbaddirectory|percent:num_routers }}</td>
</tr>
<tr id="row_aggStatisticSummary">
	<td id="aggBox">Total number of 'bad exit' routers:</td>
    <td id="aggBox">{{ counts.isbadexit }}</td>
    <td id="aggBox">{{ counts.isbadexit|percent:num_routers }}</td>
</tr>
<tr id="row_aggStatisticSummary">
	<td id="aggBox">Total number of 'exit' routers</td>
    <td id="aggBox">{{ counts.isexit }}</td>
    <td id="aggBox">{{ counts.isexit|percent:num_routers }}</td>
</tr>
<tr id="row_aggStatisticSummary">
	<td id="aggBox">Total number of 'fast' routers</td>
    <td id="aggBox">{{ counts.isfast }}</td>
    <td id="aggBox">{{ counts.isfast|percent:num_routers }}</td>
</tr>
<tr id="row_aggStatisticSummary">
	<td id="aggBox">Total number of 'guard' routers:</td>
    <td id="aggBox">{{ counts.isguard }}</td>
    <td id="aggBox">{{ counts.isguard|percent:num_routers }}</td>
</tr>
<tr id="row_aggStatisticSummary">
	<td id="aggBox">Total number of 'named' routers:</td>
    <td id="aggBox">{{ counts.isnamed }}</td>
    <td id="aggBox">{{ counts.isnamed|percent:num_routers }}</td>
</tr>
<tr id="row_aggStatisticSummary">
	<td id="aggBox">Total number of 'stable' routers</td>
    <td id="aggBox">{{ counts.isstable }}</td>
    <td id="aggBox">{{ counts.isstable|percent:num_routers }}</td>
</tr>
<tr id="row_aggStatisticSummary">
	<td id="aggBox">Total number of 'running' routers:</td>
    <td id="aggBox">{{ counts.isrunning }}</td>
    <td id="aggBox">{{ counts.isrunning|percent:num_routers }}</td>
</tr>
<tr id="row_aggStatisticSummary">
	<td id="aggBox">Total number of 'valid' routers:</td>
    <td id="aggBox">{{ counts.isvalid }}</td>
    <td id="aggBox">{{ counts.isvalid|percent:num_routers }}</td>
</tr>
<tr id="row_aggStatisticSummary">
	<td id="aggBox">Total number of 'v2dir' routers:</td>
    <td id="aggBox">{{ counts.isv2dir }}</td>
    <td id="aggBox">{{ counts.isv2dir|percent:num_routers }}</td>
</tr>
</table>
</td>
</tr>
</table>

<br />
{% endspaceless %}
{% endblock %}
